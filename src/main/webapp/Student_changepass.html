<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>修改密码</title>
    <link rel="stylesheet" href="css/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="css/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/axios.min.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="css/util.css"/>
</head>
<body style="background-color: #eee;">
<div id="app" class="container">
    <div class="row">
        <div class="col-md-12">
            <div style="background-color: #fff;">
                <!-- 顶部大图 -->
                <div style="height: 220px; background-image: url(img/wstop.jpg);" class="pm"></div>
                <!-- 导航栏 -->
                <nav class="navbar navbar-default" role="navigation">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse"
                                    data-target="#example-navbar-collapse">
                                <span class="sr-only">切换导航</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="/student_page.html">学生信息管理</a>
                        </div>
                        <div class="collapse navbar-collapse" id="example-navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="/Student_manager.html">本人信息查询</a>
                                </li>
                                <li>
                                    <a href="#">成绩查询</a>
                                </li>
                                <li>
                                    <a href="/login/changePasswordinterface">密码修改</a>
                                </li>
                                <li>
                                    <a href="/login/stulogout">注销</a>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        课程查询
                                        <b class="caret"></b>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="#">今日课表</a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#">本周课表</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <div style="margin-top: 35px;">
                    <div class="row">
                        <div class="col-md-6 col-md-offset-3">
                            <div class="text-left" style="margin: 17px auto;width: 300px;">
                                <form method="post">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="学号" v-model="student.stuid"
                                               v-on:click="back()" v-on:keyUp.enter="changePassword()"/>
                                    </div>
                                    <div class="form-group">
                                        <input type="password" class="form-control" placeholder="原始密码"
                                               v-model="student.pass" v-on:click="back()"
                                               v-on:keyUp.enter="changePassword()"/>
                                    </div>
                                    <div class="form-group">
                                        <input type="password" class="form-control" placeholder="新密码"
                                               v-model="newpass" v-on:click="back()"
                                               v-on:keyUp.enter="changePassword()"/>
                                    </div>
                                    <div class="form-group">
                                        <input type="password" class="form-control" placeholder="再次输入新密码"
                                               v-model="newpass2" v-on:click="back()"
                                               v-on:keyUp.enter="changePassword()"/>
                                    </div>
                                    <p style="color: #ff6666; font-size: 15px">{{msg}}</p>
                                    <div class="div6">
                                        <span>
                                            <button type="button" class="btn btn-info btn-block"
                                                    v-on:click="changePassword()">修改</button>
                                        </span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 页脚 -->
                <div class="jumbotron text-center "
                     style="margin-bottom: 0;margin-top: 35px;background-color: #eff4fa;padding-top: 12.5px;padding-bottom: 12.5px;">
                    <a href="#">关于项目</a> |
                    <a href="#">服务条款</a> |
                    <a href="#">隐私政策</a> |
                    <a href="#">客服中心</a> |
                    <a href="#">联系我们</a> |
                    <a href="#"> 帮助中心</a>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    var vue = new Vue({
        el: '#app',
        data: {
            student: {
                stuid: '',
                pass: ''
            },
            newstudent: {
                stuid: '',
                pass: ''
            },
            newpass:'',
            newpass2:'',
            msg:''
        },
        methods: {
            changePassword: function () {
                if (vue.student.stuid == '') {
                    vue.msg = '请输入你的学号';
                } else if (vue.student.pass == '') {
                    vue.msg = '请输入你的原始密码';
                } else if (vue.newpass==''){
                    vue.msg='请输入新密码';
                } else if (vue.newpass2==''){
                    vue.msg='请再输入一遍新密码'
                } else if (vue.newpass!=vue.newpass2){
                    vue.msg='两次密码输入不一致'
                } else if (vue.newpass.length<6){
                    vue.msg='新密码长度过短'
                } else if (vue.newpass==vue.student.pass){
                    vue.msg='新密码不能和原密码相同'
                } else {
                    axios.post('/student/returnCurrentStudent',this.student).then(function (result) {
                        if(result.data.indexOf("账户正确")!=-1){
                            vue.newstudent.stuid=vue.student.stuid;
                            vue.newstudent.pass=vue.newpass2;
                            axios.post('/student/changepass',vue.newstudent).then(function (value) {
                                window.location.href="/index.html";
                            }).catch(function (reason) {
                                console.log(reason);
                            });
                        }else{
                            vue.msg= result.data;
                        }
                    }).catch(function (err) {
                        vue.msg= '密码修改失败';
                        console.log(err);
                    });
                }
            },
            back: function() {
                vue.msg = '';
            }
        },
        mounted: function () {
            
        }
    });
</script>

</html>
